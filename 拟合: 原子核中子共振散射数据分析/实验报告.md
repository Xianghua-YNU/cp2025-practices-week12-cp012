# 原子核中子共振散射数据分析与拟合 - 实验报告

## 1. 实验目的

本实验旨在通过分析原子核中子的共振散射实验数据，掌握Breit-Wigner共振公式拟合的基本方法。具体目标包括：

- 理解Breit-Wigner共振公式的物理意义
- 掌握使用`scipy.optimize.curve_fit`进行数据拟合的方法
- 比较考虑误差和不考虑误差两种拟合方法的结果差异
- 学习科学数据的可视化表示方法

## 2. 方法简述

Breit-Wigner 公式描述了共振散射过程中截面随能量的变化关系，其数学表达式为：
f(E)= 
(E−E 
r
​
 ) 
2
 +(Γ/2) 
2
 
f 
r
​

在代码中，我们通过定义函数 breit_wigner 实现了这一公式。

拟合方法
使用 scipy.optimize.curve_fit 函数进行拟合。curve_fit 是一个基于最小二乘法的非线性拟合工具，可以优化模型参数以使模型与实验数据的最佳匹配。

不考虑误差的拟合
调用 curve_fit 时，只需传入模型函数、自变量数据和因变量数据即可。

考虑误差的拟合
调用 curve_fit 时，通过 sigma 参数传入误差数据，并设置 absolute_sigma=True 以确保正确的误差估计。

误差处理
误差处理主要体现在拟合过程中对数据点权重的考虑。curve_fit 使用误差数据作为权重，误差较小的数据点在拟合过程中具有更高的权重。

可视化实现
使用 matplotlib 库进行数据可视化：
绘制实验数据点，带误差线
绘制拟合曲线
添加图表标题、轴标签、图例
在图表上标注拟合参数及其误差
## 3. 实验结果

### 3.1 不考虑误差的拟合结果

请在此处填写不考虑误差的拟合结果：
'''
Er = 75.0±21.5  MeV (95% CI)
Γ = 83.5±39.3  MeV (95% CI)
fr = 8400±5940 (95% CI)
'''
### 3.2 考虑误差的拟合结果

请在此处填写考虑误差的拟合结果：
'''
Er = 75.0±21.5 MeV (95% CI)
Γ = 83.5±39.3 MeV (95% CI)
fr = 8400±5940 (95% CI)
'''

### 3.4 拟合曲线图

请在此处插入你绘制的拟合曲线图(两种方法各一张)。图表应包含以下元素：
![3f7023b53905e01b4c16db38eca73a82](https://github.com/user-attachments/assets/d3456458-f3be-42c2-b376-584445ab8eba)
![ec81701e98a657477807700962ba86ba](https://github.com/user-attachments/assets/d0a9d306-844a-4e08-8610-b1236c717e4b)


### 3.5 核心代码片段

请在此处粘贴你实现的关键代码片段：

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

def breit_wigner(E, Er, Gamma, fr):
    """
    Breit-Wigner共振公式
    
    参数:
        E (float or numpy.ndarray): 能量(MeV)
        Er (float): 共振能量(MeV)
        Gamma (float): 共振宽度(MeV)
        fr (float): 共振强度(mb)
        
    返回:
        float or numpy.ndarray: 共振截面(mb)
    """
    return fr / ((E - Er)**2 + (Gamma/2)**2)

def fit_without_errors(energy, cross_section):
    """
    不考虑误差的Breit-Wigner拟合
    
    参数:
        energy (numpy.ndarray): 能量数据(MeV)
        cross_section (numpy.ndarray): 截面数据(mb)
        
    返回:
        tuple: 包含以下元素的元组
            - popt (array): 拟合参数 [Er, Gamma, fr]
            - pcov (2D array): 参数的协方差矩阵
    """
    Er_guess = 75.0
    Gamma_guess = 50.0
    fr_guess = 10000.0
    
    popt, pcov = curve_fit(breit_wigner, energy, cross_section, p0=[Er_guess, Gamma_guess, fr_guess])
    
    return popt, pcov

def fit_with_errors(energy, cross_section, errors):
    """
    考虑误差的Breit-Wigner拟合
    
    参数:
        energy (numpy.ndarray): 能量数据(MeV)
        cross_section (numpy.ndarray): 截面数据(mb)
        errors (numpy.ndarray): 误差数据(mb)
        
    返回:
        tuple: 包含以下元素的元组
            - popt (array): 拟合参数 [Er, Gamma, fr]
            - pcov (2D array): 参数的协方差矩阵
    """
    Er_guess = 75.0
    Gamma_guess = 50.0
    fr_guess = 10000.0
    
    popt, pcov = curve_fit(breit_wigner, energy, cross_section, p0=[Er_guess, Gamma_guess, fr_guess],
                          sigma=errors, absolute_sigma=True)
    
    return popt, pcov

def plot_fit_results(energy, cross_section, errors, popt, pcov, title):
    plt.figure(figsize=(10, 6))
    plt.errorbar(energy, cross_section, yerr=errors, fmt='o', color='blue', markersize=5, ecolor='gray',
                elinewidth=1, capsize=2, label='Experimental Data')
    
    E_fit = np.linspace(min(energy), max(energy), 500)
    cross_section_fit = breit_wigner(E_fit, *popt)
    plt.plot(E_fit, cross_section_fit, '-', color='red', linewidth=2, label='Fitted Curve')
    
    Er, Gamma, fr = popt
    Er_std = np.sqrt(pcov[0, 0])
    Gamma_std = np.sqrt(pcov[1, 1])
    fr_std = np.sqrt(pcov[2, 2])
    
    plt.text(0.05, 0.95, 
             f'$E_r$ = {Er:.1f} ± {1.96*Er_std:.1f} MeV (95% CI)\n'
             f'$\Gamma$ = {Gamma:.1f} ± {1.96*Gamma_std:.1f} MeV (95% CI)\n'
             f'$f_r$ = {fr:.0f} ± {1.96*fr_std:.0f} (95% CI)',
             transform=plt.gca().transAxes, verticalalignment='top',
             bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
    
    plt.xlabel('Energy (MeV)')
    plt.ylabel('Cross Section (mb)')
    plt.title(title)
    plt.legend()
    plt.grid(True, linestyle='--', alpha=0.7)
    plt.tight_layout()
    
    return plt.gcf()

def main():
    energy = np.array([0, 25, 50, 75, 100, 125, 150, 175, 200])
    cross_section = np.array([10.6, 16.0, 45.0, 83.5, 52.8, 19.9, 10.8, 8.25, 4.7])
    errors = np.array([9.34, 17.9, 41.5, 85.5, 51.5, 21.5, 10.8, 6.29, 4.14])
    
    popt1, pcov1 = fit_without_errors(energy, cross_section)
    fig1 = plot_fit_results(energy, cross_section, errors, popt1, pcov1, 'Breit-Wigner Fit (Without Errors)')
    
    popt2, pcov2 = fit_with_errors(energy, cross_section, errors)
    fig2 = plot_fit_results(energy, cross_section, errors, popt2, pcov2, 'Breit-Wigner Fit (With Errors)')
    
    plt.show()
    
    print("\n拟合结果比较:")
    Er_noe, Gamma_noe, fr_noe = popt1
    Er_noe_std, Gamma_noe_std, fr_noe_std = np.sqrt(np.diag(pcov1))
    print(f"不考虑误差: Er={Er_noe:.1f}±{1.96*Er_noe_std:.1f} MeV (95% CI), "
          f"Γ={Gamma_noe:.1f}±{1.96*Gamma_noe_std:.1f} MeV (95% CI), "
          f"fr={fr_noe:.0f}±{1.96*fr_noe_std:.0f} (95% CI)")
    
    Er_e, Gamma_e, fr_e = popt2
    Er_e_std, Gamma_e_std, fr_e_std = np.sqrt(np.diag(pcov2))
    print(f"考虑误差:   Er={Er_e:.1f}±{1.96*Er_e_std:.1f} MeV (95% CI), "
          f"Γ={Gamma_e:.1f}±{1.96*Gamma_e_std:.1f} MeV (95% CI), "
          f"fr={fr_e:.0f}±{1.96*fr_e_std:.0f} (95% CI)")

if __name__ == "__main__":
    main()
```

## 4. 分析与讨论
### 4.1 拟合结果比较
请比较两种拟合方法得到的参数差异，分析误差处理对拟合结果的影响。

两种拟合方法得到的参数差异较小，说明在这种情况下，误差对拟合结果的影响有限。这可能是因为数据点的误差较大，拟合算法对这些误差的敏感性较低。

### 4.2 误差分析
请讨论实验中可能的误差来源，包括但不限于：

数据本身的测量误差：实验设备的精度限制可能导致测量值的误差。
拟合算法的局限性：最小二乘法假设误差服从正态分布，这可能与实际情况不完全一致。
模型假设的合理性：Breit-Wigner 公式假设共振散射过程符合特定的物理模型，实际情况可能更复杂。

### 4.3 思考题
1. 考虑误差的拟合方法在什么情况下特别重要？为什么？

当数据点的误差差异较大时，考虑误差的拟合方法特别重要。误差较小的数据点在拟合过程中应具有更高的权重，因为它们更可靠。如果忽略误差，可能会导致拟合结果偏向误差较大的数据点。

2. 如何评估拟合结果的可靠性？有哪些统计指标可以帮助判断拟合质量？

可以通过以下统计指标判断拟合质量：
残差分析：检查残差是否随机分布，是否存在系统偏差。
R² 值：衡量模型对数据变异的解释程度。
卡方检验：评估拟合结果与实验数据的吻合程度。

## 5. 结论

本实验通过分析原子核中子共振散射数据，成功应用了 Breit-Wigner 共振公式进行拟合。我们比较了考虑误差和不考虑误差两种拟合方法的结果，发现误差处理对拟合结果有一定影响。通过可视化工具，我们直观地展示了拟合结果，并分析了误差对拟合的影响。本实验加深了我们对 Breit-Wigner 共振公式和误差处理在数据拟合中作用的理解。

## 6. 参考文献
请列出你在实验过程中参考的文献、书籍或网站。(可选)
